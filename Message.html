<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èŠå¤©</title>
<style>
body{font-family:"Microsoft YaHei",sans-serif;background:#ededed;display:flex;flex-direction:column;height:100vh;margin:0;}
.chat-header{background:#d1d1d1;padding:12px;text-align:center;font-weight:bold;color:#333;position:relative;}
#backBtn{position:absolute;left:10px;top:50%;transform:translateY(-50%);background:none;border:none;font-size:16px;cursor:pointer;}
.chat-body{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;scroll-behavior:smooth;}
.chat-time{text-align:center;color:#666;font-size:12px;background:rgba(200,200,200,0.3);padding:4px 10px;border-radius:10px;display:inline-block;margin:10px auto;}
.message{display:flex;margin-bottom:10px;}
.message.other{align-items:flex-start;}
.message.other .bubble{background:#fff;margin:10px;border-radius:8px 8px 8px 0;padding:10px 14px;max-width:70%;}
.message.self{flex-direction:row-reverse;align-items:flex-start;}
.message.self .bubble{background:#95ec69;margin:10px;border-radius:8px 8px 0 8px;padding:10px 14px;max-width:70%;}
.chat-input-container{display:flex;padding:10px;background:#f5f5f5;border-top:1px solid #ccc;}
#chatInput{flex:1;padding:10px;border-radius:6px;border:1px solid #ccc;margin-right:6px;}
#sendBtn{padding:10px 14px;border:none;border-radius:6px;background:#07c160;color:#fff;cursor:pointer;}
#sendBtn:hover{background:#06b157;}
</style>
</head>
<body>

<div class="chat-header">
  <button id="backBtn">â† è¿”å›</button>
  <span id="chatHeader">å¥½å‹</span>
</div>

<div class="chat-body" id="chatBody">
  <div class="chat-time">å†å²è®°å½•</div>
</div>

<div class="chat-input-container">
  <input type="text" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯...">
  <button id="sendBtn">å‘é€</button>
</div>

<script>
  function getQueryParam(name){ return new URLSearchParams(window.location.search).get(name); }
  
  let currentUser = decodeURIComponent(getQueryParam("user") || localStorage.getItem("currentUser") || "å˜»å˜»");
  let currentChat = decodeURIComponent(getQueryParam("friend") || "å°ç›¼å®å®");
  document.getElementById("chatHeader").textContent=currentChat;
  
  // æ¯ä¸ªç”¨æˆ·çš„èŠå¤©è®°å½•
  const chatRecords = {
    "xixi2333": {
      "å°ç›¼å®å®": [
        "xixi2333: å®å®ï¼Œä½ æ–°æ‹çš„ç…§ç‰‡å¥½å¥½çœ‹ï¼",
        "PAN1108: è°¢è°¢å‘€ï¼Œç”¨æ–°æœè£…æ‹çš„ã€‚",
        "xixi2333: æ±‚æ¨¡æ¿ï¼Œæˆ‘ä¹Ÿè¦æ‹ï¼"
      ],
      "å®˜è°·åº—": [
        "å®˜è°·åº—: å®è´æ‚¨å¥½å‘€ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨~",
        "xixi2333: ã€å‚¬å‘è´§ã€‘",
        "å®˜è°·åº—: å®è´æ‚¨å¥½å‘€ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨~",
        "xixi2333: ã€å‚¬å‘è´§!ã€‘"
      ],
      "å°äº‘": [
        "xixi2333: å°äº‘ï¼Œåˆ«æ‹…å¿ƒå•¦~",
        "å°äº‘: å‘œå‘œå‘œï¼Œä¸‹è¾ˆå­æˆ‘ä¸€å®šå¥½å¥½å­¦å‰ç«¯",
        "å°äº‘: å¯æ˜¯AIå¤ªå¥½ç”¨äº†qwq"
      ]
    },
    "PAN1108": {
      "å°å¸Œ": [
        "xixi2333: å®å®å®å®ï¼Œè¿™æ¬¡æ–°è°·ä¸€èµ·å‡‘æ»¡èµ å˜›ï¼Ÿ",
        "PAN1108: å¥½å‘€ï¼Œæˆ‘æŠŠè¦ä¹°çš„å‘ç»™ä½ ã€‚ "
      ],
      "å¦ˆå¦ˆ": [
        "å¹¸ç¦å¹³å®‰: ä½ å¼Ÿå¼Ÿä¹Ÿè¦å¼€å­¦äº†ï¼Œä½ çš„ç”Ÿæ´»è´¹å‡åŠå“ˆ",
        "PAN1108: çŸ¥é“äº†ã€‚"
      ],
      "å¼Ÿå¼Ÿ": [
        "ä½ ç›¸ä¿¡å…‰å—: å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼",
        "PAN1108: è°¢è°¢ã€‚"
      ],
      "å®˜è°·åº—":[
        "å®˜è°·åº—:è®¢å•å·²å‘è´§ï¼Œå…·ä½“ç‰©æµä¿¡æ¯è¯·ç§æˆ³å°çª—~"
      ]
    }
  };
  
  const chatBody=document.getElementById("chatBody");
  const chatInput=document.getElementById("chatInput");
  const sendBtn=document.getElementById("sendBtn");
  
  // æ¸²æŸ“æ¶ˆæ¯ï¼ˆæ”¯æŒ HTMLï¼‰
  function addMessage(text,self=false){
    const msgDiv=document.createElement("div");
    msgDiv.className=self?"message self":"message other";
    const bubble=document.createElement("div");
    bubble.className="bubble";
    bubble.innerHTML=text; //ä½¿ç”¨ innerHTML ä»¥æ”¯æŒå¯Œæ–‡æœ¬
    msgDiv.appendChild(bubble);
    chatBody.appendChild(msgDiv);
    chatBody.scrollTop=chatBody.scrollHeight;
  }

  function addTimeMessage(timeText){
  const timeDiv = document.createElement("div");
  timeDiv.className = "chat-time";
  timeDiv.textContent = timeText;
  chatBody.appendChild(timeDiv);
  chatBody.scrollTop = chatBody.scrollHeight;
}

  // è‡ªåŠ¨å›å¤ï¼ˆæ”¯æŒå¤šè½®å¯¹è¯ + innerHTMLï¼‰
  const keywordResponses = {
    "å°ç›¼å®å®": { 
      "xixi2333":{
      
    }
    },
    "å®˜è°·åº—":{
      "xixi2333":{
      "ç‰©æµä¿¡æ¯":[
        {sender:"å®˜è°·åº—", text:"äº²æ‚¨å¥½ï¼Œå·²ä¸ºæ‚¨æŸ¥è¯¢åˆ°è®¢å• YX1475829634ï¼šä»ç®¡æ•…å¸‚å‘å¾€åŒ—å²¸å¸‚ï¼Œæ”¶ä»¶äººä¸ºå°ç›¼å®å®ã€‚"},
        {sender:"xixi2333", text:"è°¢è°¢å®¢æœå°å§å§ï½"}
      ]
    },
      "PAN1108":{
        "ç‰©æµä¿¡æ¯":[
        {sender:"å®˜è°·åº—",text:"å·²ä¸ºæ‚¨æŸ¥è¯¢åˆ°äºŒæœŸå‘¨è¾¹è´­ä¹°è®¢å•ï¼šä»ä»ç®¡æ•…å¸‚å‘å¾€åŒ—å²¸å¸‚ï¼Œæ”¶ä»¶äººä¸ºç›¼æ‚¦ã€‚"}   
      ]
      }
    },
    "ä½ ç›¸ä¿¡å…‰å—":{
      "xixi2333":{
      "å§å§":[
        {sender:"ä½ ç›¸ä¿¡å…‰å—", text:"ä½ æ˜¯æˆ‘å§çš„æœ‹å‹ï¼Ÿ"},
        {sender:"xixi2333", text:"å—¯å—¯ï¼Œæˆ‘å«å°å¸Œï¼Œæ˜¯å¥¹çš„ç½‘å‹"},
        {sender:"ä½ ç›¸ä¿¡å…‰å—", text:"å•Šæˆ‘çŸ¥é“ä½ ã€‚æˆ‘å§æœ€è¿‘çŠ¶æ€å¾ˆä¸å¥½ï¼Œä¹Ÿä¸çŸ¥é“å¥¹åœ¨å¿™ä»€ä¹ˆ"},
        {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"å’Œå¥¹èŠå¤©æ€»æ˜¯æœ‰ä¸€æ­æ²¡ä¸€æ­çš„ã€‚"}
      ],
      "åº™":[
        {sender:"xixi2333",text:"ä½ å§å»å¾€ç›¼æœˆæµ·é‚£è¾¹äº†ã€‚"},
        {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"é‚£ä¸æ˜¯æˆ‘å®¶å‘¨å›´å—ï¼Œå¥¹æ€ä¹ˆä¸æ¥æ‰¾æˆ‘ï¼Ÿ"},
        {sender:"xixi2333",text:"ä½ ä»¬å‘¨å›´ï¼Ÿé‚£é™„è¿‘æ˜¯ä¸æ˜¯æœ‰ä¸ªä»€ä¹ˆåº™ï¼Ÿ"},
        {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"æ˜¯å“¦ï¼Œæˆ‘ä»¬è¿™è¾¹æœ‰ä¸ªä¸–éšåº™"},
        {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"å¯æœ‰åäº†ï¼Œæ¯å¤©éƒ½æœ‰å¥½å¤šå¥½å¤šäººå»é‚£å„¿"}
      ],
      "è¡¥ä¹ ç­":[
      {sender:"xixi2333",text:"çœ‹å¸–å­è¯´ä½ åˆæœ‰è¡¥ä¹ ç­è¦å»ï¼Ÿ"},
      {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"æ˜¯å•Šï¼Œçˆ¸å¦ˆé€¼æˆ‘å»çš„ï¼Œè¿˜æ˜¯å§å§è‡ªç”±å•Šï¼Œæˆå¹´äº†å°±å¯ä»¥æƒ³åšä»€ä¹ˆå°±åšä»€ä¹ˆ"},
      {sender:"xixi2333",text:"å‘ƒå…¶å®ä¹Ÿå¹¶ä¸æ˜¯...ç®—äº†"}
      ],
      "ç›¼æœˆæµ·":[
      {sender:"xixi2333",text:"ä½ å¬è¯´è¿‡ç›¼æœˆæµ·å—ï¼Ÿ"},
      {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"å½“ç„¶ï¼Œå°±åœ¨æˆ‘ä»¬ç›¼éƒ¦å¸‚å•Šã€‚æˆ‘å§è¿˜è¯´æˆ‘ç”Ÿæ—¥é‚£å¤©è¦å¸¦æˆ‘é€ƒè¯¾å»é‚£é‡Œå‘¢ï¼Œæˆ‘éƒ½ä¸æ•¢å’Œæˆ‘å¦ˆå¦ˆè¯´ã€‚"},
      {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"åªæ˜¯å¥¹ç°åœ¨è¿˜æ²¡è”ç³»æˆ‘ï¼Œä¹Ÿä¸çŸ¥é“è¿˜åšä¸åšæ•°ã€‚"},
      {sender:"xixi2333",text:"......"},
      ],
      "ç¤¼ç‰©":[
      {sender:"xixi2333",text:"é‚£æ—¢ç„¶ä½ ä¸Šè¡¥ä¹ ç­æ²¡æœ‰æ—¶é—´ï¼Œæœ€åä½ é€ç»™å°ç›¼ä»€ä¹ˆç”Ÿæ—¥ç¤¼ç‰©ï¼Ÿ"},
      {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"å˜¿å˜¿ï¼Œæˆ‘æŠŠä»å°å¸¦åœ¨èº«è¾¹çš„å¥¥Xæ›¼ç»™å¥¹å•¦ã€‚"},
      {sender:"xixi2333",text:"å‘ƒï¼Œå¥¹ä¼šå–œæ¬¢ï¼Ÿ"},
      {sender:"ä½ ç›¸ä¿¡å…‰å—",text:"å½“ç„¶ï¼å°æ—¶å€™å¥¹æƒ³è¦çˆ¸å¦ˆéƒ½æ²¡ç»™å¥¹ä¹°å‘¢ï¼æˆ‘ç»™çš„è¿™ä¸ªè¿˜æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è€ƒæ»¡åˆ†æ—¶ï¼Œçˆ¸çˆ¸ç»™æˆ‘é€‰çš„ç¤¼ç‰©"}
      ]
      }
    },
    // {sender:"",text:""},
    "å¹¸ç¦å¹³å®‰":{
      "xixi2333":{
      "å¥³å„¿":[
        {sender:"xixi2333",text:"é˜¿å§¨å¥½ï¼Œæˆ‘æ˜¯ä½ å¥³å„¿çš„æœ‹å‹"},
        {sender:"å¹¸ç¦å¹³å®‰",text:"ä»€ä¹ˆå¥³å„¿ï¼Œæˆ‘å‘Šè¯‰ä½ æˆ‘æ²¡æœ‰é’±ï¼Œè¦æ’•ç¥¨å°±æ’•ã€‚"},
        {sender:"xixi2333",text:"...ä¸æ˜¯çš„é˜¿å§¨ï¼Œæˆ‘å«å°å¸Œï¼Œæˆ‘..."},
        {sender:"å¹¸ç¦å¹³å®‰",text:`å°å¸Œï¼Ÿå“¦ï¼Œæƒ³èµ·æ¥äº†ï¼Œå¥¹<b>æ¸¸æˆ</b>ä¸Šçš„æœ‹å‹æ˜¯å§ï¼Œä½ æ‰¾æˆ‘æœ‰äº‹,è¿˜æ˜¯å°ç›¼ï¼Ÿ`}
      ],
      "æ¸¸æˆ":[
      {sender:"xixi2333",text:"é˜¿å§¨ï¼Œæˆ‘å’Œå°ç›¼åœ¨æ¸¸æˆä¸Šè®¤è¯†åçº¦ç€çº¿ä¸‹è§é¢çš„ï¼Œå¯æ˜¯"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"çº¿ä¸‹è§é¢ï¼Ÿå¥¹ä¸€å¤©ç©é‚£ä¸ªæ¸¸æˆè®¤è¯†äº›ä»€ä¹ˆä¸ä¸‰ä¸å››çš„äººï¼Œè¿˜æ•¢çº¦å‡ºå»è§é¢ï¼Ÿ"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"è¿˜ä¸€å¤©æ‹¿é’±ä¹°ä»€ä¹ˆè°·å­ï¼Œä¸å°±æ˜¯å †é“çš®ç©æ„å„¿ï¼Œä¸ºäº†ç½‘ä¸Šé‚£äº›å‡ä¸œè¥¿æµªè´¹é’±ï¼å¥¹ä»¥å‰å¯ä¸æ˜¯è¿™æ ·çš„ï¼Œéƒ½æ˜¯ä½ ä»¬è¿™ç¾¤äººæŠŠå¥¹å¸¦åäº†ï¼"},
      {sender:"xixi2333",text:"...ğŸ™‚"}
      ],
      "è°·å­":[
      {sender:"xixi2333",text:"é‚£å¥¹ç•™åœ¨å®¶é‡Œçš„è°·å­å‘¢ï¼Ÿ"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"å‡†å¤‡æ‰”äº†ï¼Œä¸è¿‡ä½ è¦æ˜¯æƒ³è¦é‚£å †ä¸œè¥¿ï¼Œæˆ‘å¯ä»¥ä¾¿å®œå–ç»™ä½ ã€‚"},
      {sender:"xixi2333",text:"...èµ°æ¸ é“å§ã€‚"},
      {type:"time",text:"æˆ‘æ”¶åˆ°ä¸€ä»½ä»å¾€å—å¸‚ç›¼éƒ¦åŒºå¯„æ¥çš„å¿«é€’ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªä¿æŠ¤å¾—å½“çš„ç›’å­ã€‚ä¸Šé¢å†™ç€ï¼šâ€œç›¼æ‚¦â€äºŒå­—ã€‚"}
      ],
      "ä¸–éšåº™":[
      {sender:"xixi2333",text:"é˜¿å§¨ï¼Œå…³äºä¸–éšåº™æ‚¨æœ‰ä»€ä¹ˆäº†è§£å—ï¼Ÿ"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"é‚£åº§åº™ï¼Ÿæˆ‘ä»¬è¿™å„¿æœ€æœ‰åçš„æ™¯ç‚¹ä¹‹ä¸€å§ã€‚"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"æ€ä¹ˆï¼Œä½ è¦æ¥æ±‚å­ï¼Ÿä½ ä¸æ˜¯å’Œå°ç›¼å·®ä¸å¤šå¹´çºªå—ï¼Ÿ"},
      {sender:"xixi2333",text:"ä¸æ˜¯ä¸æ˜¯...æ˜¯å°ç›¼ä¹‹å‰æèµ·è¿‡é‚£ä¸ªåœ°æ–¹ã€‚"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"å“¦ï¼Œé‚£åœ°æ–¹æŒºçµçš„ï¼Œå°±æ˜¯æœ‰ç‚¹å¤ªçµäº†ï¼Œæˆ‘éƒ½æ˜¯åœ¨æ‹œè¿‡é‚£é‡Œåæ€€ä¸Šå­©å­çš„"},
      {sender:"å¹¸ç¦å¹³å®‰",text:`ä¹Ÿä¸çŸ¥é“æ˜¯å¥½äº‹è¿˜æ˜¯åäº‹...è¯´èµ·æ¥å°±æ˜¯è¿™å‡ å¤©å»çš„ï¼Œç®—ç€è¦åˆ°ä¿©å­©å­<b>ç”Ÿæ—¥</b>äº†ã€‚`}
      ],
      "ç”Ÿæ—¥":[
      {sender:"xixi2333",text:"å°ç›¼ç”Ÿæ—¥å·²ç»è¿‡äº†ï¼Œè¿™å‘¨å…­ã€‚"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"å•Šå¯¹ï¼Œæˆ‘éƒ½å¿˜äº†ã€‚å¥¹è¿˜å‡†æˆ‘å¯„ç‚¹å®¶é‡Œçš„ä¸œè¥¿è¿‡å»ã€‚è¿™ä¸ªæ²¡è‰¯å¿ƒçš„ï¼Œè‡ªä»ä»å®¶é‡Œæ¬å‡ºå»åï¼Œå°±ä¸æ€ä¹ˆå’Œæˆ‘ä»¬è”ç³»äº†ï¼Œè¿å¿«é€’ä¹Ÿå¾ˆå°‘æ”¶ã€‚"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"æˆ‘å®¶å®‰å®‰ä¹Ÿè¦è¿‡ç”Ÿæ—¥äº†ï¼Œå§å¼Ÿä¿©ä¸æ˜¯è¿˜çº¦ç€è¦å»æµ·è¾¹ç©å˜›ã€‚"},
      {sender:"xixi2333",text:"æ¬¸ï¼Ÿé˜¿å§¨ä½ æ€ä¹ˆçŸ¥é“ï¼Œå¥¹å¼Ÿå¼Ÿä¸æ˜¯è¯´..."},
      {sender:"å¹¸ç¦å¹³å®‰",text:"å˜ï¼Œä½ ä»¥ä¸ºä½ ä»¬è¿™äº›å°å­©åœ¨æˆ‘é¢å‰èƒ½æœ‰å•¥ç§˜å¯†ï¼Ÿ"},
      {sender:"å¹¸ç¦å¹³å®‰",text:"å®‰å®‰å’Œä»–å§ä¹ æƒ¯ä¸€æ ·ï¼Œéƒ½å–œæ¬¢ç”¨é‡è¦çš„äººåä½œå¯†ç ã€‚æˆ‘ä¸€è¯•ä¸€ä¸ªå‡†ï¼Œä¸è¿‡å±…ç„¶ä¸æ˜¯æˆ‘çš„åå­—ã€‚"},
      {sender:"xixi2333",text:"ğŸ˜…"},
      {type:"time",text:"ä¸è¿‡å°ç›¼å¦ˆå¦ˆè¿™è¯çš„æ„æ€ï¼Œéš¾é“å°ç›¼çš„å¯†ç ä¹Ÿæ˜¯äººåï¼Ÿæˆ‘çŸ¥é“å¥¹è´¦å·æ˜¯PAN+å¥¹çš„ç”Ÿæ—¥ï¼Œè¯´ä¸å®šå¯ä»¥è¯•ç€ç™»å½•å¥¹çš„è´¦å·ã€‚"}
      ]
      }
    },
    "å¦ˆå¦ˆ": { 
      "PAN1108":{
        "è´Ÿæ‹…":[
        {type:"time",text:"å†å²è®°å½•"},
        {sender:"å¦ˆå¦ˆ",text:"è¿™ä¸ªæœˆçš„é’±å‘¢?"},
        {sender:"PAN1108",text:"(å·²è½¬è´¦)"},
        {sender:"å¦ˆå¦ˆ",text:"è¿™è¿˜å·®ä¸å¤šï¼Œä½ çˆ¸åœ¨å®‰å®‰ä¸€å²çš„æ—¶å€™å°±å‡ºäº‹äº†ã€‚è¿™ä¹ˆå¤šå¹´æˆ‘å…»ä½ ä»¬ä¸¤ä¸ªä¸å®¹æ˜“ï¼Œä½ èƒ½æŒ£é’±å°±å¤šåˆ†æ‹…ç‚¹ã€‚"},
        {sender:"PAN1108",text:"æˆ‘çŸ¥é“ã€‚"},
        {sender:"å¦ˆå¦ˆ",text:`å“¼ï¼Œä½ çŸ¥é“ï¼Ÿä½ <b>å¼Ÿå¼Ÿ</b>è¡¥ä¹ ç­ä¹Ÿè¦å¼€è¯¾äº†ï¼Œåˆ«å¿˜äº†æ¯æœˆç»™å®¶é‡Œ<b>æ‰“é’±</b>ï¼Œæ™“å¾—ï¼Ÿ`},
        {sender:"PAN1108",text:"å—¯ã€‚"}
      ],
      "å¼Ÿå¼Ÿ":[
      {type:"time",text:"8æœˆ15æ—¥"},
      {sender:"å¦ˆå¦ˆ",text:"ï¼ˆå‘æ¥ä¸€å¼ å›¾ç‰‡ï¼šä¸€ç¯‡ä½œæ–‡ï¼‰"},
      {sender:"å¦ˆå¦ˆ",text:"ä½ å¼Ÿå¼Ÿä½œæ–‡å¾—å¥–äº†ï¼Œä½ çœ‹çœ‹ã€‚"},
      {sender:"PAN1108",text:"ä¸ç”¨äº†ï¼Œç¥è´ºä»–"},
      {sender:"PAN1108",text:"æƒ³æ¥ä½ ä¸€å®šå¾ˆå¼€å¿ƒï¼Œå®‰å®‰å¯ä¸€å®šè¦æ’‘ä½ä»–çš„æˆç»©"},
      {sender:"PAN1108",text:`å…å¾—è®©æ‚¨<b>å¤±æœ›</b>`},
      {sender:"å¦ˆå¦ˆ",text:"ä½ è¿™å­©å­æ€ä¹ˆè¯´è¯çš„"},
      ],
      "å¤±æœ›":[
      {type:"time",text:"8æœˆ18æ—¥"},
      {sender:"å¦ˆå¦ˆ",text:"ä½ çœ‹ä½ ä¸€å¤©å¤©çš„ï¼Œå¿ƒæ€å…¨èŠ±åœ¨é‚£ä¸ªç ´æ¸¸æˆä¸Šï¼"},
      {sender:"PAN1108",text:"æˆ‘åˆæ€ä¹ˆæƒ¹ä½ äº†"},
      {sender:"å¦ˆå¦ˆ",text:`ä½ çœ‹ä½ è¿™æ˜¯è¯¥å¯¹å¦ˆå¦ˆè¯´çš„è¯å—ï¼è¦æ˜¯ä½ <b>å§å§</b>åœ¨å¤©ä¹‹çµçŸ¥é“ä½ è¿™ä¸ªæ ·å­ï¼Œå¥¹ä¼šæ€ä¹ˆæƒ³ï¼Ÿï¼`},
      {sender:"PAN1108",text:"å¥¹å½“ç„¶ä¼šè§‰å¾—æˆ‘è¿‡å¾—å¼€å¿ƒå°±è¡Œ"},
      {sender:"å¦ˆå¦ˆ",text:"å¼€å¿ƒï¼Ÿä½ æ˜¯å¼€å¿ƒäº†ï¼Œè¿™ä¸ªå®¶å‘¢ï¼Ÿä½ å§å§é‚£ä¹ˆæ‡‚äº‹ä¼˜ç§€ï¼Œå°±ä¸ºäº†æ•‘ä½ æ‰å‡ºçš„äº‹ï¼Œä½ å¯¹å¾—èµ·å¥¹å—ï¼Ÿ"},
      {sender:"PAN1108",text:"æˆ‘å§æ´»ç€çš„æ—¶å€™ä½ æ€ä¹ˆä¸è¯´å¥¹å¥½ï¼Œä½ ä¸å°±æ˜¯æƒ³ç”¨å¥¹æ¥é“å¾·ç»‘æ¶æˆ‘å—"},
      {sender:"PAN1108",text:"è¿˜å‡æƒºæƒºåœ°è£…å¾—å¤šæƒ³å¥¹ä¼¼çš„ï¼Œæ¶å¿ƒ"},
      ],
      "æ‰“é’±":[
      {type:"time",text:"8æœˆ1æ—¥"},
      {sender:"PAN1108",text:"ï¼ˆå·²è½¬è´¦ï¼‰"},
      {sender:"å¦ˆå¦ˆ",text:"æ”¶åˆ°äº†ï¼Œä½ è¿˜æ˜¯å°‘åœ¨é‚£äº›è™šæ‹Ÿä¸œè¥¿ä¸Šæµªè´¹é’±ã€‚"},
      {sender:"PAN1108",text:"å—¯ï¼Œæˆ‘çŸ¥é“çš„ã€‚"},
      {sender:"å¦ˆå¦ˆ",text:`æˆ‘ä¹Ÿä¸æ˜¯è¦é€¼ä½ ï¼Œä½†ä½ ç°åœ¨è¡¨ç°è¶Šæ¥è¶Šå·®äº†ã€‚ä½ ä»¥å‰å¤š<b>ä¼˜ç§€</b>å•Šï¼Œå¦ˆå¦ˆçœŸçš„æ˜¯ä¸ºäº†ä½ å¥½ã€‚`},
      ],
      "ä¸¥æ ¼":[
      {type:"time",text:"9æœˆ18æ—¥"},
      {sender:"PAN1108",text:`æ‚¨åˆç»™å°å®‰æŠ¥<b>è¡¥ä¹ ç­</b>äº†ï¼Ÿä»–åˆæ¥æ‰¾æˆ‘äº†ã€‚`},
      {sender:"å¦ˆå¦ˆ",text:"ä½ å°‘ç®¡é—²äº‹ï¼Œæˆ‘å‘Šè¯‰ä½ ä½ å¯åˆ«å¸¦åä½ å¼Ÿå¼Ÿã€‚ä»–èªæ˜ï¼Œå¥½å¥½åŸ¹å…»ä»¥åå¤§æœ‰ä½œä¸ºï¼"},
      {sender:"PAN1108",text:"......éšä¾¿æ‚¨ï¼Œå‘Šè¯‰ä»–æ²¡ä»€ä¹ˆäº‹åˆ«æ‰¾æˆ‘ã€‚"},
      {sender:"å¦ˆå¦ˆ",text:"å˜¿ä½ è¿™ä¸ªå½“å§å§çš„è¿˜å«Œå¼ƒä½ å¼Ÿå¼Ÿæ˜¯å§ï¼Œäººå®¶å°å®‰æ¯”ä½ æ‡‚äº‹å¤šäº†"},
      ]
      }
    },
      "å¼Ÿå¼Ÿ":{
        "PAN1108":{
        "è¡¥ä¹ ç­":[
        {sender:"å¼Ÿå¼Ÿ",text:"å§ï¼Œæ•‘å‘½â€”â€”â€”â€”â€”â€”"},
        {sender:"PAN1108",text:"æ€ä¹ˆäº†ï¼Ÿ"},
        {sender:"å¼Ÿå¼Ÿ",text:"å¦ˆå¥¹åˆç»™æˆ‘æŠ¥åäº†è¡¥ä¹ ç­ï¼Œæˆ‘çš„å‘¨æœ«å•Š"},
        {sender:"PAN1108",text:"å¦ˆå¦ˆä¹Ÿæ˜¯çæƒœä½ çš„å¤©èµ‹ï¼Œä¸è¿‡å¥¹æ˜¯æœ‰ç‚¹é€¼å¾—å¤ªç´§äº†ã€‚"},
        {sender:"å¼Ÿå¼Ÿ",text:"æ‰ä¸æ˜¯ï¼Œæ˜æ˜å§å§ä»¥å‰å¾—äº†é‚£ä¹ˆå¤šå¥–ï¼Œæ¯”æˆ‘å¯èªæ˜å¤šäº†"},
        {sender:"å¼Ÿå¼Ÿ",text:`è¿˜æ˜¯å§ä½ æœ‰<b>å‹‡æ°”</b>ï¼Œä¸€ä¸ªäººç¦»å®¶è‡ªå·±ç”Ÿæ´»ã€‚å“ï¼Œæˆ‘æ„Ÿè§‰æˆ‘å†åœ¨è¿™é‡Œå‘†ä¸‹å»æˆ‘å°±è¦<b>æŠ‘éƒ</b>äº†`},
        {sender:"PAN1108",text:"ä¸è®¸èƒ¡è¯´ï¼Œå‹åŠ›å¤ªå¤§å°±å‡ºå»èµ°èµ°ã€‚"}  
        ],
        "å‹‡æ°”":[
        {type:"time",text:"9æœˆ2æ—¥"},
        {sender:"å¼Ÿå¼Ÿ",text:"å§ï¼Œä½ çœŸèµ°å•¦ï¼Ÿ"},
        {sender:"PAN1108",text:`å—¯ï¼Ÿæ˜¯å§ï¼Œåæ­£å·²ç»åœ¨<b>åŠ¨è½¦</b>ä¸Šäº†`},
        {sender:"å¼Ÿå¼Ÿ",text:"å¤ªå‹‡äº†å§ï¼Œå¦ˆå¦ˆå¥¹å¯ç”Ÿæ°”äº†ï¼"},
        {sender:"PAN1108",text:"å—¯ï¼Œæ˜¯æŒºå‹‡çš„ã€‚å¥¹æŠ¥è­¦äº†ï¼Ÿ"},
        {sender:"å¼Ÿå¼Ÿ",text:`é‚£å€’æ²¡æœ‰ï¼Œä½†å¥¹çœ‹è§ä½ ç•™åœ¨æˆ¿é—´é‡Œçš„<b>å­—æ¡</b>åï¼Œä¸€æ•´å¤©éƒ½å…³åœ¨æˆ¿é—´é‡Œï¼Œç°åœ¨è¿˜æ²¡å‡ºæ¥ã€‚`}
        ],
        "å“­":[
        {type:"time",text:"8æœˆ11æ—¥"},
        {sender:"å¼Ÿå¼Ÿ",text:"å§ï¼Œä½ è¿˜å¥½å—ï¼Ÿ"},
        {sender:"PAN1108",text:"æˆ‘æ²¡äº‹ï¼Œä½ æ€ä¹ˆè¿˜æ²¡ç¡ï¼Ÿ"},
        {sender:"å¼Ÿå¼Ÿ",text:"å­¦æ ¡ä½œä¸šå¤ªå¤šäº†ï¼Œæˆ‘æ²¡å†™å®Œï¼Œè¿™ä¼šå„¿åœ¨è¢«çªé‡Œå·å·å†™å‘¢"},
        {sender:"PAN1108",text:"å¯¹çœ¼ç›ä¸å¥½ï¼Œè€Œä¸”ä½ æœ¬æ¥æ‰å“­è¿‡ã€‚å…ˆç¡è§‰ï¼Œæ˜å¤©å’Œè€å¸ˆè§£é‡Šä¸€ä¸‹ã€‚"},
        {sender:"å¼Ÿå¼Ÿ",text:`æˆ‘æ²¡å“­ï¼åªæ˜¯å¬åˆ°ä½ ä»¬åµæ¶æœ‰äº›å“åˆ°äº†...è€Œä¸”è¦æ˜¯å¦ˆå¦ˆçŸ¥é“æˆ‘æ²¡å†™å®Œ<b>ä½œæ–‡</b>ï¼Œè‚¯å®šåˆè¦æŠŠæˆ‘å…³åœ¨å®¶é‡Œä¸å‡†å‡ºå»ç©......`},
          {sender:"å¼Ÿå¼Ÿ",text:"å¥¹æœ€è¿‘å¿ƒæƒ…å¯å·®äº†ï¼Œæ‰€ä»¥æ‰ä¼šçªç„¶é—¯åˆ°ä½ æˆ¿é—´ã€‚å§ä½ ä¸è¦æ°”åèº«å­å•Š"},
          {sender:"PAN1108",text:"ä¸ä¼šçš„ï¼Œæˆ‘å·²ç»æ²¡ç”Ÿæ°”äº†ã€‚"},
          {sender:"PAN1108",text:"ä¸è¿‡å¥¹æœ€è¿‘å¿ƒæƒ…å¾ˆå·®å—ï¼Ÿ"},
          {sender:"å¼Ÿå¼Ÿ",text:`å—¯ï¼Œè€Œä¸”æˆ‘è¿˜å¬åˆ°å¥¹æ€»å¿µå¨ä»€ä¹ˆ<b>ç¦ä½‘</b>å•Šåº™å•Šçš„ï¼Œè€å“äººäº†`}
        ]
      }
    }
    ,
    "å°æ‚¦":{}
  };
  
  // æ¸²æŸ“å†å²è®°å½•ï¼ˆå»æ‰å‘é€è€…åå­—ï¼‰
if (chatRecords[currentUser] && chatRecords[currentUser][currentChat]) {
  chatRecords[currentUser][currentChat].forEach(msg => {
    // æ£€æŸ¥æ˜¯å¦å¸¦â€œ:â€ï¼Œå¦‚æœæœ‰ï¼Œå°±åˆ‡æ‰åå­—éƒ¨åˆ†
    const parts = msg.split(":");
    const text = parts.length > 1 ? parts.slice(1).join(":").trim() : msg;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±å‘çš„ï¼ˆä¿ç•™æ°”æ³¡æ–¹å‘ï¼‰
    const self = msg.startsWith(currentUser + ":");

    addMessage(text, self);
  });
}

  
  // è¿”å›æŒ‰é’®
  document.getElementById("backBtn").onclick=()=>{ location.href="FriendList.html"; }
  
  // å‘é€æ¶ˆæ¯é€»è¾‘
  sendBtn.onclick=()=>{
    const text=chatInput.value.trim();
    if(!text) return;
    const msg=currentUser+": "+text;
    // addMessage(msg,true);
  
    if(!chatRecords[currentUser]) chatRecords[currentUser]={};
    if(!chatRecords[currentUser][currentChat]) chatRecords[currentUser][currentChat]=[];
    chatRecords[currentUser][currentChat].push(msg);
  
    chatInput.value="";
  
    // æ£€æŸ¥å…³é”®è¯è§¦å‘
    const responses=keywordResponses[currentChat];
    if(responses && responses[currentUser]){
      const userResponse = responses[currentUser];
      for(let key in userResponse){
        if(text.includes(key)){
          const dialogue = userResponse[key];
let i = 0;
const interval = setInterval(() => {
  const d = dialogue[i];

  if (d.type === "time") {
    // æ’å…¥æ—¶é—´æç¤ºæ ·å¼
    const timeDiv = document.createElement("div");
    timeDiv.className = "chat-time";
    timeDiv.textContent = d.text;
    chatBody.appendChild(timeDiv);
    chatBody.scrollTop = chatBody.scrollHeight;
  } else {
    // æ™®é€šæ¶ˆæ¯
    const fullMsg = d.text;
    const self = (d.sender === currentUser);
    addMessage(fullMsg, self);
    chatRecords[currentUser][currentChat].push(fullMsg);
  }

  i++;
  if (i >= dialogue.length) clearInterval(interval);
}, 900);

          return;
        }
      }
    }
  
    // é»˜è®¤è‡ªåŠ¨å›å¤
    setTimeout(()=>{
      const autoMsg=" ï¼Ÿ";
      addMessage(autoMsg);
      chatRecords[currentUser][currentChat].push(autoMsg);
    },800);
  };
  
  // å›è½¦å‘é€
  chatInput.addEventListener("keypress",e=>{if(e.key==="Enter") sendBtn.click();});

  
  // æ¸²æŸ“è‡ªå®šä¹‰æ—¶é—´æ°”æ³¡
  function addTimeBubble(content) {
    const timeDiv = document.createElement("div");
    timeDiv.className = "chat-time";
    timeDiv.textContent = content;
    chatBody.appendChild(timeDiv);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  // å¦‚æœæ­£åœ¨å’Œâ€œå°æ‚¦â€èŠå¤©ï¼Œåˆ™éšè—è¾“å…¥æ å¹¶æ˜¾ç¤ºé€šè¯æŒ‰é’®
if (currentChat === "å°æ‚¦") {
  const inputContainer = document.querySelector(".chat-input-container");
  addTimeBubble("å°æ‚¦ï¼Ÿåº”è¯¥å°±æ˜¯å°ç›¼å§ï¼Œå¥¹å±…ç„¶è¿™æ—¶å€™åœ¨çº¿...å¦‚æœæˆ‘ç”¨è¿™ä¸ªè´¦å·è”ç³»å¥¹ï¼Œä¹Ÿè®¸èƒ½è”ç³»ä¸Šã€‚å‡†å¤‡å¥½çš„è¯å°±ç»™å¥¹æ‰“ä¸ªç”µè¯å§ã€‚");
  inputContainer.innerHTML = `
    <button id="callBtn" 
      style="width:100%; padding:12px; background:#07c160; color:white; border:none; border-radius:8px; font-size:16px;">
      ğŸ“ å‘èµ·é€šè¯
    </button>
  `;

  // ç‚¹å‡»æŒ‰é’®è·³è½¬
  document.getElementById("callBtn").onclick = () => {
    location.href = "END.html";  // â† ä½ è¦è·³è½¬çš„é¡µé¢
  };
}

  </script>
  

</body>
</html>
