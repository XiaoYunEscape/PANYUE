<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>聊天</title>
<style>
body{font-family:"Microsoft YaHei",sans-serif;background:#ededed;display:flex;flex-direction:column;height:100vh;margin:0;}
.chat-header{background:#d1d1d1;padding:12px;text-align:center;font-weight:bold;color:#333;position:relative;}
#backBtn{position:absolute;left:10px;top:50%;transform:translateY(-50%);background:none;border:none;font-size:16px;cursor:pointer;}
.chat-body{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;scroll-behavior:smooth;}
.chat-time{text-align:center;color:#666;font-size:12px;background:rgba(200,200,200,0.3);padding:4px 10px;border-radius:10px;display:inline-block;margin:10px auto;}
.message{display:flex;margin-bottom:10px;}
.message.other{align-items:flex-start;}
.message.other .bubble{background:#fff;margin:10px;border-radius:8px 8px 8px 0;padding:10px 14px;max-width:70%;}
.message.self{flex-direction:row-reverse;align-items:flex-start;}
.message.self .bubble{background:#95ec69;margin:10px;border-radius:8px 8px 0 8px;padding:10px 14px;max-width:70%;}
.chat-input-container{display:flex;padding:10px;background:#f5f5f5;border-top:1px solid #ccc;}
#chatInput{flex:1;padding:10px;border-radius:6px;border:1px solid #ccc;margin-right:6px;}
#sendBtn{padding:10px 14px;border:none;border-radius:6px;background:#07c160;color:#fff;cursor:pointer;}
#sendBtn:hover{background:#06b157;}
</style>
</head>
<body>

<div class="chat-header">
  <button id="backBtn">← 返回</button>
  <span id="chatHeader">好友</span>
</div>

<div class="chat-body" id="chatBody">
  <div class="chat-time">历史记录</div>
</div>

<div class="chat-input-container">
  <input type="text" id="chatInput" placeholder="输入消息...">
  <button id="sendBtn">发送</button>
</div>

<script>
  function getQueryParam(name){ return new URLSearchParams(window.location.search).get(name); }
  
  let currentUser = decodeURIComponent(getQueryParam("user") || localStorage.getItem("currentUser") || "嘻嘻");
  let currentChat = decodeURIComponent(getQueryParam("friend") || "小盼宝宝");
  document.getElementById("chatHeader").textContent=currentChat;
  
  // 每个用户的聊天记录
  const chatRecords = {
    "xixi2333": {
      "小盼宝宝": [
        "xixi2333: 宝宝，你新拍的照片好好看！",
        "PAN1108: 谢谢呀，用新服装拍的。",
        "xixi2333: 求模板，我也要拍！"
      ],
      "官谷店": [
        "官谷店: 宝贝您好呀，有什么可以帮您~",
        "xixi2333: 【催发货】",
        "官谷店: 宝贝您好呀，有什么可以帮您~",
        "xixi2333: 【催发货!】"
      ],
      "小云": [
        "xixi2333: 小云，别担心啦~",
        "小云: 呜呜呜，下辈子我一定好好学前端",
        "小云: 可是AI太好用了qwq"
      ]
    },
    "PAN1108": {
      "小希": [
        "xixi2333: 宝宝宝宝，这次新谷一起凑满赠嘛？",
        "PAN1108: 好呀，我把要买的发给你。 "
      ],
      "妈妈": [
        "幸福平安: 你弟弟也要开学了，你的生活费减半哈",
        "PAN1108: 知道了。"
      ],
      "弟弟": [
        "你相信光吗: 姐，生日快乐！",
        "PAN1108: 谢谢。"
      ],
      "官谷店":[
        "官谷店:订单已发货，具体物流信息请私戳小窗~"
      ]
    }
  };
  
  const chatBody=document.getElementById("chatBody");
  const chatInput=document.getElementById("chatInput");
  const sendBtn=document.getElementById("sendBtn");
  
  // 渲染消息（支持 HTML）
  function addMessage(text,self=false){
    const msgDiv=document.createElement("div");
    msgDiv.className=self?"message self":"message other";
    const bubble=document.createElement("div");
    bubble.className="bubble";
    bubble.innerHTML=text; //使用 innerHTML 以支持富文本
    msgDiv.appendChild(bubble);
    chatBody.appendChild(msgDiv);
    chatBody.scrollTop=chatBody.scrollHeight;
  }

  function addTimeMessage(timeText){
  const timeDiv = document.createElement("div");
  timeDiv.className = "chat-time";
  timeDiv.textContent = timeText;
  chatBody.appendChild(timeDiv);
  chatBody.scrollTop = chatBody.scrollHeight;
}

  // 自动回复（支持多轮对话 + innerHTML）
  const keywordResponses = {
    "小盼宝宝": { 
      "xixi2333":{
      "拨打电话10131108":[
        {sender:"小盼宝宝", text:"（解锁结局1 <a href='#' style='color:red;'>梦醒</a>）"},
        {sender:"xixi2333", text:"什么意思呀？"},
        {sender:"小盼宝宝", text:"<b>嘻嘻，你醒啦。</b>"}
      ]
    }
    },
    "官谷店":{
      "xixi2333":{
      "物流信息":[
        {sender:"官谷店", text:"亲您好，已为您查询到订单 YX1475829634：从管故市发往北岸市，收件人为小盼宝宝。"},
        {sender:"xixi2333", text:"谢谢客服小姐姐～"}
      ]
    },
      "PAN1108":{
        "物流信息":[
        {sender:"官谷店",text:"已为您查询到二期周边购买订单：从从管故市发往北岸市，收件人为盼悦。"}   
      ]
      }
    },
    "你相信光吗":{
      "xixi2333":{
      "姐姐":[
        {sender:"你相信光吗", text:"你是我姐的朋友？"},
        {sender:"xixi2333", text:"嗯嗯，我叫小希，是她的网友"},
        {sender:"你相信光吗", text:"啊我知道你。我姐最近状态很不好，也不知道她在忙什么"},
        {sender:"你相信光吗",text:"和她聊天总是有一搭没一搭的。"}
      ],
      "庙":[
        {sender:"xixi2333",text:"你姐去往盼月海那边了。"},
        {sender:"你相信光吗",text:"那不是我家周围吗，她怎么不来找我？"},
        {sender:"xixi2333",text:"你们周围？那附近是不是有个什么庙？"},
        {sender:"你相信光吗",text:"是哦，我们这边有个世隐庙"},
        {sender:"你相信光吗",text:"可有名了，每天都有好多好多人去那儿"}
      ],
      "补习班":[
      {sender:"xixi2333",text:"看帖子说你又有补习班要去？"},
      {sender:"你相信光吗",text:"是啊，爸妈逼我去的，还是姐姐自由啊，成年了就可以想做什么就做什么"},
      {sender:"xixi2333",text:"呃其实也并不是...算了"}
      ],
      "盼月海":[
      {sender:"xixi2333",text:"你听说过盼月海吗？"},
      {sender:"你相信光吗",text:"当然，就在我们盼郦市啊。我姐还说我生日那天要带我逃课去那里呢，我都不敢和我妈妈说。"},
      {sender:"你相信光吗",text:"只是她现在还没联系我，也不知道还做不做数。"},
      {sender:"xixi2333",text:"......"},
      ],
      "礼物":[
      {sender:"xixi2333",text:"那既然你上补习班没有时间，最后你送给小盼什么生日礼物？"},
      {sender:"你相信光吗",text:"嘿嘿，我把从小带在身边的奥X曼给她啦。"},
      {sender:"xixi2333",text:"呃，她会喜欢？"},
      {sender:"你相信光吗",text:"当然！小时候她想要爸妈都没给她买呢！我给的这个还是我第一次考满分时，爸爸给我选的礼物"}
      ]
      }
    },
    // {sender:"",text:""},
    "幸福平安":{
      "xixi2333":{
      "女儿":[
        {sender:"xixi2333",text:"阿姨好，我是你女儿的朋友"},
        {sender:"幸福平安",text:"什么女儿，我告诉你我没有钱，要撕票就撕。"},
        {sender:"xixi2333",text:"...不是的阿姨，我叫小希，我..."},
        {sender:"幸福平安",text:`小希？哦，想起来了，她<b>游戏</b>上的朋友是吧，你找我有事,还是小盼？`}
      ],
      "游戏":[
      {sender:"xixi2333",text:"阿姨，我和小盼在游戏上认识后约着线下见面的，可是"},
      {sender:"幸福平安",text:"线下见面？她一天玩那个游戏认识些什么不三不四的人，还敢约出去见面？"},
      {sender:"幸福平安",text:"还一天拿钱买什么谷子，不就是堆铁皮玩意儿，为了网上那些假东西浪费钱！她以前可不是这样的，都是你们这群人把她带坏了！"},
      {sender:"xixi2333",text:"...🙂"}
      ],
      "谷子":[
      {sender:"xixi2333",text:"那她留在家里的谷子呢？"},
      {sender:"幸福平安",text:"准备扔了，不过你要是想要那堆东西，我可以便宜卖给你。"},
      {sender:"xixi2333",text:"...走渠道吧。"},
      {type:"time",text:"我收到一份从往南市盼郦区寄来的快递，里面是一个保护得当的盒子。上面写着：“盼悦”二字。"}
      ],
      "世隐庙":[
      {sender:"xixi2333",text:"阿姨，关于世隐庙您有什么了解吗？"},
      {sender:"幸福平安",text:"那座庙？我们这儿最有名的景点之一吧。"},
      {sender:"幸福平安",text:"怎么，你要来求子？你不是和小盼差不多年纪吗？"},
      {sender:"xixi2333",text:"不是不是...是小盼之前提起过那个地方。"},
      {sender:"幸福平安",text:"哦，那地方挺灵的，就是有点太灵了，我都是在拜过那里后怀上孩子的"},
      {sender:"幸福平安",text:`也不知道是好事还是坏事...好像就是这几天，要到俩孩子<b>生日</b>了？`}
      ],
      "生日":[
      {sender:"xixi2333",text:"小盼生日已经过了，这周六。"},
      {sender:"幸福平安",text:"啊对，我都忘了。她还准我寄点家里的东西过去。这个没良心的，自从从家里搬出去后，就不怎么和我们联系了，连快递也很少收。"},
      {sender:"幸福平安",text:"说起来我家安安也要过生日了，姐弟俩不是还约着要去海边玩嘛。"},
      {sender:"xixi2333",text:"欸？阿姨你怎么知道，她弟弟不是说..."},
      {sender:"幸福平安",text:"嘁，你以为你们这些小孩在我面前能有啥秘密？"},
      {sender:"幸福平安",text:"安安和他姐习惯一样，都喜欢用重要的人名作密码。我一试一个准，不过居然不是我的名字。"},
      {sender:"xixi2333",text:"😅"},
      {type:"time",text:"不过小盼妈妈这话的意思，难道小盼的密码也是人名？我知道她账号是PAN+她的生日，说不定可以试着登录她的账号。"}
      ]
      }
    },
    "妈妈": { 
      "PAN1108":{
        "负担":[
        {type:"time",text:"历史记录"},
        {sender:"妈妈",text:"这个月的钱呢?"},
        {sender:"PAN1108",text:"(已转账)"},
        {sender:"妈妈",text:"这还差不多，你爸在安安一岁的时候就出事了。这么多年我养你们两个不容易，你能挣钱就多分担点。"},
        {sender:"PAN1108",text:"我知道。"},
        {sender:"妈妈",text:`哼，你知道？你<b>弟弟</b>补习班也要开课了，别忘了每月给家里<b>打钱</b>，晓得？`},
        {sender:"PAN1108",text:"嗯。"}
      ],
      "弟弟":[
      {type:"time",text:"8月15日"},
      {sender:"妈妈",text:"（发来一张图片：一篇作文）"},
      {sender:"妈妈",text:"你弟弟作文得奖了，你看看。"},
      {sender:"PAN1108",text:"不用了，祝贺他"},
      {sender:"PAN1108",text:"想来你一定很开心，安安可一定要撑住他的成绩"},
      {sender:"PAN1108",text:`免得让您<b>失望</b>`},
      {sender:"妈妈",text:"你这孩子怎么说话的"},
      ],
      "失望":[
      {type:"time",text:"8月18日"},
      {sender:"妈妈",text:"你看你一天天的，心思全花在那个破游戏上！"},
      {sender:"PAN1108",text:"我又怎么惹你了"},
      {sender:"妈妈",text:`你看你这是该对妈妈说的话吗！要是你<b>姐姐</b>在天之灵知道你这个样子，她会怎么想？！`},
      {sender:"PAN1108",text:"她当然会觉得我过得开心就行"},
      {sender:"妈妈",text:"开心？你是开心了，这个家呢？你姐姐那么懂事优秀，就为了救你才出的事，你对得起她吗？"},
      {sender:"PAN1108",text:"我姐活着的时候你怎么不说她好，你不就是想用她来道德绑架我吗"},
      {sender:"PAN1108",text:"还假惺惺地装得多想她似的，恶心"},
      ],
      "打钱":[
      {type:"time",text:"8月1日"},
      {sender:"PAN1108",text:"（已转账）"},
      {sender:"妈妈",text:"收到了，你还是少在那些虚拟东西上浪费钱。"},
      {sender:"PAN1108",text:"嗯，我知道的。"},
      {sender:"妈妈",text:`我也不是要逼你，但你现在表现越来越差了。你以前多<b>优秀</b>啊，妈妈真的是为了你好。`},
      ],
      "严格":[
      {type:"time",text:"9月18日"},
      {sender:"PAN1108",text:`您又给小安报<b>补习班</b>了？他又来找我了。`},
      {sender:"妈妈",text:"你少管闲事，我告诉你你可别带坏你弟弟。他聪明，好好培养以后大有作为！"},
      {sender:"PAN1108",text:"......随便您，告诉他没什么事别找我。"},
      {sender:"妈妈",text:"嘿你这个当姐姐的还嫌弃你弟弟是吧，人家小安比你懂事多了"},
      ]
      }
    },
      "弟弟":{
        "PAN1108":{
        "补习班":[
        {sender:"弟弟",text:"姐，救命——————"},
        {sender:"PAN1108",text:"怎么了？"},
        {sender:"弟弟",text:"妈她又给我报名了补习班，我的周末啊"},
        {sender:"PAN1108",text:"妈妈也是珍惜你的天赋，不过她是有点逼得太紧了。"},
        {sender:"弟弟",text:"才不是，明明姐姐以前得了那么多奖，比我可聪明多了"},
        {sender:"弟弟",text:`还是姐你有<b>勇气</b>，一个人离家自己生活。哎，我感觉我再在这里呆下去我就要<b>抑郁</b>了`},
        {sender:"PAN1108",text:"不许胡说，压力太大就出去走走。"}  
        ],
        "勇气":[
        {type:"time",text:"9月2日"},
        {sender:"弟弟",text:"姐，你真走啦？"},
        {sender:"PAN1108",text:`嗯？是吧，反正已经在<b>动车</b>上了`},
        {sender:"弟弟",text:"太勇了吧，妈妈她可生气了！"},
        {sender:"PAN1108",text:"嗯，是挺勇的。她报警了？"},
        {sender:"弟弟",text:`那倒没有，但她看见你留在房间里的<b>字条</b>后，一整天都关在房间里，现在还没出来。`}
        ],
        "哭":[
        {type:"time",text:"8月11日"},
        {sender:"弟弟",text:"姐，你还好吗？"},
        {sender:"PAN1108",text:"我没事，你怎么还没睡？"},
        {sender:"弟弟",text:"学校作业太多了，我没写完，这会儿在被窝里偷偷写呢"},
        {sender:"PAN1108",text:"对眼睛不好，而且你本来才哭过。先睡觉，明天和老师解释一下。"},
        {sender:"弟弟",text:`我没哭！只是听到你们吵架有些吓到了...而且要是妈妈知道我没写完<b>作文</b>，肯定又要把我关在家里不准出去玩......`},
          {sender:"弟弟",text:"她最近心情可差了，所以才会突然闯到你房间。姐你不要气坏身子啊"},
          {sender:"PAN1108",text:"不会的，我已经没生气了。"},
          {sender:"PAN1108",text:"不过她最近心情很差吗？"},
          {sender:"弟弟",text:`嗯，而且我还听到她总念叨什么<b>福佑</b>啊庙啊的，老吓人了`}
        ]
      }
    }
    };
  
  // 渲染历史记录（去掉发送者名字）
if (chatRecords[currentUser] && chatRecords[currentUser][currentChat]) {
  chatRecords[currentUser][currentChat].forEach(msg => {
    // 检查是否带“:”，如果有，就切掉名字部分
    const parts = msg.split(":");
    const text = parts.length > 1 ? parts.slice(1).join(":").trim() : msg;

    // 判断是不是自己发的（保留气泡方向）
    const self = msg.startsWith(currentUser + ":");

    addMessage(text, self);
  });
}

  
  // 返回按钮
  document.getElementById("backBtn").onclick=()=>{ location.href="FriendList.html"; }
  
  // 发送消息逻辑
  sendBtn.onclick=()=>{
    const text=chatInput.value.trim();
    if(!text) return;
    const msg=currentUser+": "+text;
    // addMessage(msg,true);
  
    if(!chatRecords[currentUser]) chatRecords[currentUser]={};
    if(!chatRecords[currentUser][currentChat]) chatRecords[currentUser][currentChat]=[];
    chatRecords[currentUser][currentChat].push(msg);
  
    chatInput.value="";
  
    // 检查关键词触发
    const responses=keywordResponses[currentChat];
    if(responses && responses[currentUser]){
      const userResponse = responses[currentUser];
      for(let key in userResponse){
        if(text.includes(key)){
          const dialogue = userResponse[key];
let i = 0;
const interval = setInterval(() => {
  const d = dialogue[i];

  if (d.type === "time") {
    // 插入时间提示样式
    const timeDiv = document.createElement("div");
    timeDiv.className = "chat-time";
    timeDiv.textContent = d.text;
    chatBody.appendChild(timeDiv);
    chatBody.scrollTop = chatBody.scrollHeight;
  } else {
    // 普通消息
    const fullMsg = d.text;
    const self = (d.sender === currentUser);
    addMessage(fullMsg, self);
    chatRecords[currentUser][currentChat].push(fullMsg);
  }

  i++;
  if (i >= dialogue.length) clearInterval(interval);
}, 900);

          return;
        }
      }
    }
  
    // 默认自动回复
    setTimeout(()=>{
      const autoMsg=" ？";
      addMessage(autoMsg);
      chatRecords[currentUser][currentChat].push(autoMsg);
    },800);
  };
  
  // 回车发送
  chatInput.addEventListener("keypress",e=>{if(e.key==="Enter") sendBtn.click();});
  </script>
  

</body>
</html>
